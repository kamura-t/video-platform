# 高度な視聴統計分析機能検討メモ

## 概要
動画プラットフォームにおける視聴統計分析機能の現状と将来的な拡張計画について記載する。

## 現在実装済みの機能

### 基本統計情報
- **総動画数**: 完了済み動画（公開+プライベート）
- **総ユーザー数**: アクティブユーザー数
- **総視聴数**: 累計視聴回数
- **今月のアップロード**: 新規投稿数

### 詳細統計情報
- **動画ステータス別集計**: 完了・処理中・失敗・削除済み別の動画数
- **動画可視性別集計**: 公開・プライベート別の動画数
- **ユーザー役割別集計**: 管理者・キュレーター別のユーザー数
- **人気カテゴリ**: 動画数の多い上位10カテゴリ
- **人気タグ**: 動画数の多い上位10タグ
- **過去7日間の視聴数**: 最近の視聴ログ数

### 視聴統計分析
- **視聴時間統計**
  - 平均視聴時間
  - 平均完了率
  - 総視聴時間
- **人気動画ランキング**: 視聴回数上位10位の動画一覧
- **日別視聴数**: 過去30日間の視聴ログデータ（グラフ表示用基盤）

### 技術仕様
- **APIエンドポイント**: `/api/admin/stats`
- **キャッシュ機能**: 5分間のメモリキャッシュ
- **認証**: 管理者・キュレーター権限必須
- **更新機能**: 手動更新ボタンによる強制リフレッシュ

## 今後実装可能な機能

### 1. 時系列分析
#### 📊 日別・週別・月別視聴数グラフ
- **目的**: 視聴傾向の可視化
- **実装方法**: Chart.jsまたはRecharts使用
- **データソース**: ViewLogテーブルの`viewedAt`フィールド
- **機能詳細**:
  - 日別視聴数の折れ線グラフ
  - 週別・月別の集計表示
  - 期間選択機能（7日間、30日間、90日間、1年間）
  - 前期間との比較機能

#### 📈 視聴トレンドの可視化
- **目的**: 成長率や傾向の把握
- **機能詳細**:
  - 視聴数の成長率計算
  - トレンドライン表示
  - 季節性分析
  - 異常値検出

#### 🕐 時間帯別視聴パターン分析
- **目的**: ユーザーの視聴行動パターンの把握
- **実装方法**: ViewLogの`viewedAt`を時間帯別に集計
- **機能詳細**:
  - 24時間の視聴分布ヒートマップ
  - 曜日別視聴パターン
  - ピーク時間帯の特定

### 2. ユーザー行動分析
#### 👥 ユーザー別視聴履歴
- **目的**: 個別ユーザーの視聴行動分析
- **データソース**: ViewLogテーブル + Userテーブル
- **機能詳細**:
  - ユーザー別視聴回数ランキング
  - 視聴時間分布
  - 好みのカテゴリ・タグ分析

#### 🔄 リピート視聴率
- **目的**: コンテンツの魅力度測定
- **実装方法**: 同一ユーザー・同一動画の複数視聴ログ分析
- **機能詳細**:
  - 動画別リピート率
  - ユーザー別リピート傾向
  - リピート要因分析

#### 📱 デバイス別視聴統計
- **目的**: アクセス環境の把握
- **データソース**: ViewLogの`userAgent`フィールド
- **機能詳細**:
  - モバイル・デスクトップ・タブレット別集計
  - ブラウザ別統計
  - OS別統計

#### 🌐 地域別アクセス分析
- **目的**: 地理的な視聴分布の把握
- **実装方法**: IPアドレスからの地域判定
- **機能詳細**:
  - 都道府県別アクセス数
  - 地域別人気コンテンツ
  - 地図上での可視化

### 3. コンテンツ分析
#### 🎯 カテゴリ別視聴傾向
- **目的**: カテゴリごとの人気度分析
- **機能詳細**:
  - カテゴリ別視聴回数・時間
  - カテゴリ別完了率
  - 時期別カテゴリ人気度変化

#### 🏷️ タグ別人気度分析
- **目的**: タグの効果測定
- **機能詳細**:
  - タグ別視聴統計
  - タグの組み合わせ効果分析
  - トレンドタグの特定

#### ⏱️ 動画長別視聴完了率
- **目的**: 最適な動画長の特定
- **実装方法**: 動画の`duration`と`completionRate`の相関分析
- **機能詳細**:
  - 動画長vs完了率の散布図
  - 最適動画長の推定
  - 長さ別離脱ポイント分析

#### 🎬 アップロード者別パフォーマンス
- **目的**: 投稿者の効果測定
- **機能詳細**:
  - 投稿者別視聴統計
  - 投稿者別エンゲージメント率
  - 成功投稿者の特徴分析

### 4. エンゲージメント分析
#### 💯 視聴完了率分析
- **目的**: コンテンツ品質の評価
- **データソース**: ViewLogの`completionRate`フィールド
- **機能詳細**:
  - 動画別完了率ランキング
  - 完了率の分布分析
  - 高完了率コンテンツの特徴分析

#### ⏰ 平均視聴時間vs動画長
- **目的**: 視聴者の集中力分析
- **機能詳細**:
  - 動画長と実際の視聴時間の比較
  - 離脱ポイントの特定
  - 最適な動画構成の提案

#### 🔍 検索キーワード分析
- **目的**: ユーザーニーズの把握
- **実装方法**: 検索ログの収集・分析
- **機能詳細**:
  - 人気検索キーワード
  - 検索結果のクリック率
  - 検索からの視聴完了率

#### 📊 視聴離脱ポイント分析
- **目的**: コンテンツ改善点の特定
- **実装方法**: 詳細な視聴進捗ログの収集
- **機能詳細**:
  - 動画内の離脱ポイント特定
  - 離脱要因の分析
  - 改善提案の自動生成

### 5. 予測・レコメンド
#### 🤖 視聴数予測
- **目的**: 将来の視聴数予測
- **実装方法**: 機械学習モデル（時系列予測）
- **機能詳細**:
  - 動画別視聴数予測
  - カテゴリ別成長予測
  - 季節要因を考慮した予測

#### 💡 コンテンツ推奨
- **目的**: 投稿者への改善提案
- **機能詳細**:
  - 人気コンテンツの特徴分析
  - 投稿タイミングの最適化提案
  - カテゴリ・タグの推奨

#### 📈 成長トレンド予測
- **目的**: プラットフォーム全体の成長予測
- **機能詳細**:
  - ユーザー数成長予測
  - 視聴時間成長予測
  - リソース需要予測

### 6. リアルタイム分析
#### ⚡ リアルタイム視聴者数
- **目的**: 現在の活動状況把握
- **実装方法**: WebSocketまたはServer-Sent Events
- **機能詳細**:
  - 現在の同時視聴者数
  - リアルタイム視聴数カウンター
  - アクティブユーザー数

#### 🔴 現在の人気動画
- **目的**: トレンドの即座把握
- **機能詳細**:
  - 過去1時間の人気動画
  - 急上昇動画の検出
  - バイラル動画の早期発見

#### 📊 ライブダッシュボード
- **目的**: リアルタイム監視
- **機能詳細**:
  - 自動更新ダッシュボード
  - アラート機能
  - 異常値の自動検出

## 実装優先度

### 高優先度
1. **時系列分析**: 日別・週別・月別視聴数グラフ
2. **エンゲージメント分析**: 視聴完了率分析
3. **コンテンツ分析**: カテゴリ別・タグ別視聴傾向

### 中優先度
1. **ユーザー行動分析**: 時間帯別視聴パターン
2. **コンテンツ分析**: 動画長別視聴完了率
3. **リアルタイム分析**: 現在の人気動画

### 低優先度
1. **予測・レコメンド**: 機械学習による予測機能
2. **地域別分析**: IPベースの地域分析
3. **高度なリアルタイム機能**: WebSocketベースの機能

## 技術的考慮事項

### データベース設計
- **ViewLog拡張**: より詳細な視聴ログの収集
- **インデックス最適化**: 大量データの高速クエリ
- **パーティショニング**: 時系列データの効率的管理

### パフォーマンス
- **キャッシュ戦略**: Redis等の外部キャッシュ導入
- **バッチ処理**: 重い集計処理の非同期実行
- **CDN活用**: 統計データの配信最適化

### セキュリティ
- **データ匿名化**: 個人情報の保護
- **アクセス制御**: 統計データの適切な権限管理
- **監査ログ**: 統計データアクセスの記録

### スケーラビリティ
- **マイクロサービス化**: 統計機能の独立
- **水平スケーリング**: 大量データ処理への対応
- **ストリーミング処理**: リアルタイム分析の効率化

## 関連ファイル
- `/app/api/admin/stats/route.ts` - 統計API
- `/app/admin/page.tsx` - 管理画面UI
- `/prisma/schema.prisma` - データベーススキーマ
- `/lib/recommendations.ts` - レコメンド機能（既存）

## 更新履歴
- 2024-12-19: 初版作成、基本統計機能実装完了
- 2024-12-19: 人気カテゴリ・タグ機能拡張、視聴統計分析機能追加 