ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®å‹•ç”»ä¸€è¦§ã«ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æ­è¼‰ã™ã‚‹ã‹ã©ã†ã‹ã«ã¤ã„ã¦ã€ç¾åœ¨ã®çŠ¶æ³ã¨å®Ÿè£…æ–¹æ³•ã‚’åˆ†æã—ã¦ãŠç­”ãˆã—ã¾ã™ã€‚
Search files...
Read file: lib/recommendations.ts
Read file: Docs/ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰æ©Ÿèƒ½æ¤œè¨ãƒ¡ãƒ¢.md
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èª¿æŸ»ã—ãŸçµæœã€**æ—¢ã«ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®åŸºç›¤ã¯å®Ÿè£…æ¸ˆã¿**ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ä»¥ä¸‹ã«ç¾çŠ¶ã¨æ¨å¥¨äº‹é …ã‚’ãŠç­”ãˆã—ã¾ã™ã€‚

## ğŸ” ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### âœ… **æ—¢ã«å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½**

1. **ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰æ©Ÿèƒ½** (`lib/recommendations.ts`)
   - äººæ°—å‹•ç”»ï¼ˆview_counté †ï¼‰
   - æ–°ç€å‹•ç”»ï¼ˆpublished_até †ï¼‰
   - ãƒˆãƒ¬ãƒ³ãƒ‰å‹•ç”»ï¼ˆæœ€è¿‘ã®è¦–è´æ•°ï¼‹æˆé•·ç‡ï¼‰
   - é«˜è©•ä¾¡å‹•ç”»ï¼ˆå®Œäº†ç‡ãƒ™ãƒ¼ã‚¹ï¼‰
   - ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºæ¨è–¦ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°å¥½ã¿ï¼‰

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç›¤**
   - `view_logs`ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¦–è´çµ±è¨ˆï¼‰
   - `videos.view_count`ï¼ˆè¦–è´å›æ•°ï¼‰
   - ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°æƒ…å ±

3. **APIå¯¾å¿œ**
   - `/api/videos`ã§ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆ`?sort=popular,latest,trending`ï¼‰
   - ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆ`?random=true`ï¼‰

## ğŸš€ æ¨å¥¨ã™ã‚‹å®Ÿè£…æ–¹é‡

### **ç¾åœ¨ã®åŸºç›¤ã‚’æ´»ç”¨ã—ãŸæ®µéšçš„å®Ÿè£…**

#### **Phase 1: åŸºæœ¬ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ï¼ˆå³åº§ã«å®Ÿè£…å¯èƒ½ï¼‰**
```typescript
// æ–°ã—ã„ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰APIã‚’ä½œæˆ
// app/api/recommendations/route.ts
export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const type = searchParams.get('type') || 'popular';
  const limit = parseInt(searchParams.get('limit') || '12');

  let videos;
  switch (type) {
    case 'popular':
      videos = await prisma.video.findMany({
        where: { visibility: 'PUBLIC', status: 'COMPLETED' },
        orderBy: { viewCount: 'desc' },
        take: limit,
        include: { uploader: true, categories: true, tags: true }
      });
      break;
    case 'trending':
      // æœ€è¿‘7æ—¥é–“ã®è¦–è´ãƒ­ã‚°ãƒ™ãƒ¼ã‚¹
      videos = await getTrendingVideos(limit);
      break;
    // ...
  }
  
  return NextResponse.json({ success: true, data: { videos, type } });
}
```

#### **Phase 2: ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®æ”¹è‰¯**
```tsx
// app/page.tsx ã®ä¿®æ­£
export default function HomePage() {
  return (
    <div className="container mx-auto px-4 py-8">
      {/* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <HeroSection />
      
      {/* ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <RecommendationSection title="ğŸ”¥ ãƒˆãƒ¬ãƒ³ãƒ‰" type="trending" />
      <RecommendationSection title="ğŸ‘‘ äººæ°—ã®å‹•ç”»" type="popular" />
      <RecommendationSection title="âœ¨ æ–°ç€å‹•ç”»" type="latest" />
      <RecommendationSection title="â­ é«˜è©•ä¾¡" type="highly-rated" />
    </div>
  );
}
```

#### **Phase 3: é«˜åº¦ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **
```sql
-- å®Ÿéš›ã®view_logsã‚’ä½¿ã£ãŸãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
WITH recent_views AS (
  SELECT 
    video_id,
    COUNT(*) as recent_view_count,
    AVG(completion_rate) as avg_completion_rate
  FROM view_logs 
  WHERE viewed_at > CURRENT_TIMESTAMP - INTERVAL '7 days'
  GROUP BY video_id
)
SELECT v.*, rv.recent_view_count,
       (rv.recent_view_count * 0.7 + rv.avg_completion_rate * 0.3) as trending_score
FROM videos v
JOIN recent_views rv ON v.id = rv.video_id
WHERE v.visibility = 'PUBLIC' AND v.status = 'COMPLETED'
ORDER BY trending_score DESC;
```

## ğŸ’¡ å…·ä½“çš„ãªå®Ÿè£…ææ¡ˆ

### **1. åˆ¥é€”é–‹ç™ºã®å¿…è¦æ€§ï¼šä¸è¦**
ç¾åœ¨ã®è¨­è¨ˆã§ååˆ†ã«é«˜å“è³ªãªãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

### **2. å®Ÿè£…å„ªå…ˆåº¦ã¨å·¥æ•°**

| æ©Ÿèƒ½ | å·¥æ•° | å®Ÿè£…æ™‚æœŸ | åŠ¹æœ |
|------|------|----------|------|
| åŸºæœ¬ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰API | 1-2æ—¥ | å³åº§ | é«˜ |
| ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸æ”¹è‰¯ | 2-3æ—¥ | Phase 2 | é«˜ |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ– | 1æ—¥ | Phase 3 | ä¸­ |
| é«˜åº¦ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | 3-5æ—¥ | Phase 4 | ä¸­ |

### **3. æ®µéšçš„å®Ÿè£…ãƒ—ãƒ©ãƒ³**

#### **Step 1: åŸºæœ¬å®Ÿè£…ï¼ˆ3-4æ—¥ï¼‰**
```bash
# æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
app/api/recommendations/route.ts     # ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰API
components/home/RecommendationSection.tsx  # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
components/home/VideoCard.tsx       # å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

# æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£
app/page.tsx                        # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´
```

#### **Step 2: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆ1-2æ—¥ï¼‰**
```typescript
// Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…
export class RecommendationCache {
  static async get(type: string): Promise<Video[] | null> {
    const cached = await redis.get(`recommendations:${type}`);
    return cached ? JSON.parse(cached) : null;
  }
  
  static async set(type: string, videos: Video[]): Promise<void> {
    await redis.setex(`recommendations:${type}`, 300, JSON.stringify(videos));
  }
}
```

#### **Step 3: é«˜åº¦æ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰**
- æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ
- A/Bãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

## ğŸ¯ çµè«–

**åˆ¥é€”é–‹ç™ºã®å¿…è¦æ€§ï¼šãªã—**

ç¾åœ¨ã®è¨­è¨ˆã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã§ã€ååˆ†ã«é«˜å“è³ªãªãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ç†ç”±ã‹ã‚‰ã€æ—¢å­˜åŸºç›¤ã®æ´»ç”¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ï¼š

1. **ãƒ‡ãƒ¼ã‚¿åŸºç›¤å®Œå‚™**: `view_logs`ã€`view_count`ãªã©å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒæƒã£ã¦ã„ã‚‹
2. **å®Ÿè£…æ¸ˆã¿ãƒ­ã‚¸ãƒƒã‚¯**: `lib/recommendations.ts`ã«åŸºæœ¬ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒå®Ÿè£…æ¸ˆã¿
3. **çŸ­æœŸé–“å®Ÿè£…**: 3-4æ—¥ã§åŸºæœ¬æ©Ÿèƒ½ã‚’ãƒªãƒªãƒ¼ã‚¹å¯èƒ½
4. **æ®µéšçš„æ‹¡å¼µ**: å°†æ¥çš„ãªé«˜åº¦æ©Ÿèƒ½ã¸ã®æ‹¡å¼µã‚‚å®¹æ˜“

ã‚€ã—ã‚ã€ç¾åœ¨ã®å˜ç´”ãªæ›´æ–°é †è¡¨ç¤ºã‚’æ—©æ€¥ã«ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰æ©Ÿèƒ½ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ãŒå¤§å¹…ã«å‘ä¸Šã™ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚